<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Colores</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .section h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .color-input {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="color"] {
            width: 60px;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(118, 75, 162, 0.3);
        }

        .color-result {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .color-preview {
            width: 100%;
            height: 100px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 3px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .color-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .info-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 18px;
            color: #333;
            font-weight: 700;
        }

        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            background: #e3f2fd;
            border-color: #764ba2;
        }

        .file-upload.dragover {
            background: #e3f2fd;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: crosshair;
            transition: transform 0.2s ease;
        }

        .image-preview:hover {
            transform: scale(1.02);
        }

        .color-picker-info {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }

        .picked-color {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .picked-color-preview {
            width: 100%;
            height: 60px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 3px solid #fff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .picked-color-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .crosshair {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }

        .crosshair::before {
            width: 20px;
            height: 2px;
            left: -10px;
            top: -1px;
        }

        .crosshair::after {
            width: 2px;
            height: 20px;
            left: -1px;
            top: -10px;
        }

        .palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .palette-color {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .palette-color:hover {
            transform: translateY(-5px);
        }

        .palette-swatch {
            width: 100%;
            height: 80px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 3px solid #fff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .palette-hex {
            font-weight: 700;
            color: #333;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .palette-hex:hover {
            color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 Analizador de Colores</h1>
            <p>Identifica colores hexadecimales y extrae paletas de imágenes</p>
        </div>
        
        <div class="content">
            <!-- Sección de identificación de color -->
            <div class="section">
                <h2>Identificar Color por Código</h2>
                <div class="input-group">
                    <label for="colorInput">Ingresa un código hexadecimal:</label>
                    <div class="color-input">
                        <input type="text" id="colorInput" placeholder="#764ba2" maxlength="7">
                        <input type="color" id="colorPicker">
                        <button onclick="analyzeColor()">Analizar</button>
                    </div>
                </div>
                <div id="colorResult"></div>
            </div>

            <!-- Sección de análisis de imagen -->
            <div class="section">
                <h2>Extraer Paleta de Imagen</h2>
                <div class="file-upload" id="fileUpload">
                    <div class="upload-icon">📁</div>
                    <p><strong>Arrastra una imagen aquí</strong> o haz clic para seleccionar</p>
                    <p style="color: #666; margin-top: 10px;">Formatos soportados: JPG, PNG, GIF, WEBP</p>
                </div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                <div id="imageAnalysis"></div>
            </div>
        </div>
    </div>

    <script>
        // Función para convertir hex a RGB
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        // Función para convertir RGB a HSL
        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        }

        // Función para obtener nombre aproximado del color
        function getColorName(hex) {
            const colors = {
                '#FF0000': 'Rojo', '#00FF00': 'Verde', '#0000FF': 'Azul',
                '#FFFF00': 'Amarillo', '#FF00FF': 'Magenta', '#00FFFF': 'Cian',
                '#FFA500': 'Naranja', '#800080': 'Morado', '#FFC0CB': 'Rosa',
                '#A52A2A': 'Marrón', '#808080': 'Gris', '#000000': 'Negro',
                '#FFFFFF': 'Blanco', '#764ba2': 'Morado Violeta'
            };

            const rgb = hexToRgb(hex);
            if (!rgb) return 'Color desconocido';

            // Buscar color más cercano
            let closestColor = 'Color personalizado';
            let minDistance = Infinity;

            for (const [colorHex, colorName] of Object.entries(colors)) {
                const colorRgb = hexToRgb(colorHex);
                const distance = Math.sqrt(
                    Math.pow(rgb.r - colorRgb.r, 2) +
                    Math.pow(rgb.g - colorRgb.g, 2) +
                    Math.pow(rgb.b - colorRgb.b, 2)
                );

                if (distance < minDistance) {
                    minDistance = distance;
                    closestColor = colorName;
                }
            }

            return minDistance < 50 ? closestColor : 'Color personalizado';
        }

        // Función principal para analizar color
        function analyzeColor() {
            const input = document.getElementById('colorInput').value.trim();
            let hex = input;

            if (!hex.startsWith('#')) {
                hex = '#' + hex;
            }

            const rgb = hexToRgb(hex);
            if (!rgb) {
                document.getElementById('colorResult').innerHTML = 
                    '<div style="color: red; font-weight: bold;">❌ Código de color inválido</div>';
                return;
            }

            const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
            const colorName = getColorName(hex);

            document.getElementById('colorResult').innerHTML = `
                <div class="color-preview" style="background-color: ${hex};"></div>
                <div class="color-info">
                    <div class="info-item">
                        <div class="info-label">Nombre</div>
                        <div class="info-value">${colorName}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Hexadecimal</div>
                        <div class="info-value" onclick="copyToClipboard('${hex}')" style="cursor: pointer;">${hex}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">RGB</div>
                        <div class="info-value">rgb(${rgb.r}, ${rgb.g}, ${rgb.b})</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">HSL</div>
                        <div class="info-value">hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)</div>
                    </div>
                </div>
            `;
        }

        // Event listeners para el input de color
        document.getElementById('colorInput').addEventListener('input', function() {
            const value = this.value;
            if (value.match(/^#[0-9A-F]{6}$/i)) {
                document.getElementById('colorPicker').value = value;
            }
        });

        document.getElementById('colorPicker').addEventListener('change', function() {
            document.getElementById('colorInput').value = this.value;
            analyzeColor();
        });

        // Función para copiar al portapapeles
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('¡Código copiado al portapapeles!');
            });
        }

        // Función para mostrar toast
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Configurar drag & drop para imágenes
        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');

        fileUpload.addEventListener('click', () => fileInput.click());
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        });

        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragover');
        });

        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processImage(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                processImage(e.target.files[0]);
            }
        });

        // Función para procesar imagen
        function processImage(file) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen válido.');
                return;
            }

            const analysisDiv = document.getElementById('imageAnalysis');
            analysisDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Analizando imagen y extrayendo colores...</p>
                </div>
            `;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Verificar que la imagen se cargó correctamente
                    if (this.naturalWidth && this.naturalHeight) {
                        extractColors(this);
                    } else {
                        analysisDiv.innerHTML = '<div style="color: red; text-align: center; padding: 20px;">❌ Error al cargar la imagen. Intenta con otra imagen.</div>';
                    }
                };
                img.onerror = function() {
                    analysisDiv.innerHTML = '<div style="color: red; text-align: center; padding: 20px;">❌ Error al cargar la imagen. Formato no soportado.</div>';
                };
                img.src = e.target.result;
            };
            reader.onerror = function() {
                analysisDiv.innerHTML = '<div style="color: red; text-align: center; padding: 20px;">❌ Error al leer el archivo.</div>';
            };
            reader.readAsDataURL(file);
        }

        // Función para extraer colores dominantes de la imagen
        function extractColors(img) {
            // Verificar que la imagen esté completamente cargada
            if (!img.complete || !img.naturalWidth || !img.naturalHeight) {
                console.error('Imagen no cargada correctamente');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Usar naturalWidth y naturalHeight que son más confiables
            const imgWidth = img.naturalWidth;
            const imgHeight = img.naturalHeight;
            
            // Mantener las dimensiones originales para mejor precisión del color picker
            canvas.width = imgWidth;
            canvas.height = imgHeight;
            
            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);
            
            // Para el análisis de colores dominantes, usar una versión redimensionada
            const analysisCanvas = document.createElement('canvas');
            const analysisCtx = analysisCanvas.getContext('2d');
            
            const maxSize = 200;
            const ratio = Math.min(maxSize / imgWidth, maxSize / imgHeight);
            analysisCanvas.width = imgWidth * ratio;
            analysisCanvas.height = imgHeight * ratio;
            
            analysisCtx.drawImage(img, 0, 0, analysisCanvas.width, analysisCanvas.height);
            
            const imageData = analysisCtx.getImageData(0, 0, analysisCanvas.width, analysisCanvas.height);
            const pixels = imageData.data;
            
            // Extraer colores únicos
            const colorMap = new Map();
            
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];
                const alpha = pixels[i + 3];
                
                if (alpha < 128) continue; // Ignorar píxeles transparentes
                
                // Reducir precisión para agrupar colores similares
                const key = `${Math.floor(r/10)*10}-${Math.floor(g/10)*10}-${Math.floor(b/10)*10}`;
                
                if (colorMap.has(key)) {
                    colorMap.set(key, colorMap.get(key) + 1);
                } else {
                    colorMap.set(key, 1);
                }
            }
            
            // Ordenar por frecuencia y tomar los más comunes
            const sortedColors = Array.from(colorMap.entries())
                .sort((a, b) => b[1] - a[1])
                .slice(0, 12)
                .map(([key, count]) => {
                    const [r, g, b] = key.split('-').map(Number);
                    return {
                        hex: `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`,
                        count: count
                    };
                });

            displayImageResults(img.src, sortedColors, canvas);
        }

        // Función para obtener color de un píxel específico
        function getPixelColor(canvas, x, y) {
            const ctx = canvas.getContext('2d');
            const pixel = ctx.getImageData(x, y, 1, 1).data;
            const r = pixel[0];
            const g = pixel[1];
            const b = pixel[2];
            const hex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            return { r, g, b, hex };
        }

        // Función para configurar el selector de color en imagen
        function setupImageColorPicker(img, canvas) {
            const container = img.parentElement;
            container.style.position = 'relative';
            
            let crosshair = container.querySelector('.crosshair');
            if (!crosshair) {
                crosshair = document.createElement('div');
                crosshair.className = 'crosshair';
                container.appendChild(crosshair);
            }

            img.addEventListener('mousemove', (e) => {
                const rect = img.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                crosshair.style.left = (e.clientX - rect.left) + 'px';
                crosshair.style.top = (e.clientY - rect.top) + 'px';
                crosshair.style.display = 'block';
            });

            img.addEventListener('mouseleave', () => {
                crosshair.style.display = 'none';
            });

            img.addEventListener('click', (e) => {
                const rect = img.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const x = Math.floor((e.clientX - rect.left) * scaleX);
                const y = Math.floor((e.clientY - rect.top) * scaleY);
                
                const color = getPixelColor(canvas, x, y);
                const hsl = rgbToHsl(color.r, color.g, color.b);
                const colorName = getColorName(color.hex);
                
                showPickedColor(color, hsl, colorName);
            });
        }

        // Función para mostrar el color seleccionado
        function showPickedColor(color, hsl, colorName) {
            let pickedColorDiv = document.getElementById('pickedColor');
            if (!pickedColorDiv) {
                pickedColorDiv = document.createElement('div');
                pickedColorDiv.id = 'pickedColor';
                document.getElementById('imageAnalysis').appendChild(pickedColorDiv);
            }

            pickedColorDiv.innerHTML = `
                <div class="picked-color">
                    <h4 style="margin-bottom: 15px; color: #764ba2;">🎯 Color seleccionado:</h4>
                    <div class="picked-color-preview" style="background-color: ${color.hex};"></div>
                    <div class="picked-color-info">
                        <div class="info-item">
                            <div class="info-label">Nombre</div>
                            <div class="info-value">${colorName}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Hexadecimal</div>
                            <div class="info-value" onclick="copyToClipboard('${color.hex}')" style="cursor: pointer;" title="Clic para copiar">${color.hex.toUpperCase()}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">RGB</div>
                            <div class="info-value" onclick="copyToClipboard('rgb(${color.r}, ${color.g}, ${color.b})')" style="cursor: pointer;" title="Clic para copiar">rgb(${color.r}, ${color.g}, ${color.b})</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">HSL</div>
                            <div class="info-value" onclick="copyToClipboard('hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)')" style="cursor: pointer;" title="Clic para copiar">hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)</div>
                        </div>
                    </div>
                </div>
            `;

            // Scroll suave al color seleccionado
            pickedColorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Efecto de highlight
            pickedColorDiv.style.transform = 'scale(1.05)';
            setTimeout(() => {
                pickedColorDiv.style.transform = 'scale(1)';
            }, 200);
        }

        // Función para mostrar resultados de la imagen
        function displayImageResults(imgSrc, colors, canvas) {
            const analysisDiv = document.getElementById('imageAnalysis');
            
            const paletteHtml = colors.map(color => `
                <div class="palette-color">
                    <div class="palette-swatch" style="background-color: ${color.hex};"></div>
                    <div class="palette-hex" onclick="copyToClipboard('${color.hex}')" title="Clic para copiar">
                        ${color.hex.toUpperCase()}
                    </div>
                </div>
            `).join('');

            analysisDiv.innerHTML = `
                <div class="color-picker-info">
                    🎨 Haz clic en cualquier punto de la imagen para obtener su color exacto
                </div>
                <div style="position: relative; display: inline-block;">
                    <img src="${imgSrc}" alt="Imagen analizada" class="image-preview" id="analysisImage">
                </div>
                <h3 style="margin: 20px 0; color: #764ba2;">Paleta de colores dominantes (${colors.length} colores):</h3>
                <div class="palette">
                    ${paletteHtml}
                </div>
                <p style="margin-top: 20px; color: #666; text-align: center;">
                    💡 Haz clic en cualquier código para copiarlo al portapapeles
                </p>
            `;

            // Configurar el selector de color después de que la imagen se cargue
            const img = document.getElementById('analysisImage');
            img.onload = () => {
                setupImageColorPicker(img, canvas);
            };
            
            // Si la imagen ya está cargada
            if (img.complete) {
                setupImageColorPicker(img, canvas);
            }
        }

        // Inicializar con color de ejemplo
        document.getElementById('colorInput').value = '#764ba2';
        document.getElementById('colorPicker').value = '#764ba2';
        analyzeColor();
    </script>
</body>
</html>
